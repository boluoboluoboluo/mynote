

### “AI任务”是怎么定义

在技术层面，**“AI任务”特指那些核心计算模式为“张量运算”的任务**。张量可以简单理解为多维数组（矢量是一维，矩阵是二维，更高维就是张量）。

### NPU处理本地AI任务示例

让我们以 **“手机拍摄人像模式照片”** 为例，详细拆解图中的关键步骤：

1. **触发与准备**：你按下快门。相机App捕获一帧原始图像数据。App内的图像处理管线决定需要调用“人像分割模型”，于是通过AI框架（例如华为的MindSpore Lite、苹果的Core ML）加载该模型，并将图像数据预处理成模型需要的输入格式（如调整尺寸、归一化像素值）。
2. **调度与决策**：AI框架向系统发出请求：“我需要运行这个分割模型，请分配最佳硬件。” 系统运行时和驱动开始工作：
   - **查询**：确认NPU支持该模型的所有算子。
   - **评估**：当前NPU空闲，电量充足，拍照是前台关键任务。
   - **裁决**：**决定由NPU执行**。驱动程序将模型指令和数据准备好。
3. **NPU专属执行**：
   - **数据搬运**：通过高速总线（如DMA）将预处理好的图像张量数据，从系统内存搬运到**NPU的专用高速缓存或内存**中。这一步至关重要，目的是减少访问主存的延迟和功耗。
   - **硬加速计算**：NPU的控制器读取模型指令，将其分发到内部大量的**乘加计算单元（MAC）** 和**激活函数单元**。这些单元是硬件固化的电路，专门为卷积和矩阵运算设计，以极高的并行度和能效执行计算。
   - **流水线作业**：整个模型在NPU内部像一条流水线，数据在不同的计算单元间流动，逐层完成卷积、池化、非线性激活等操作。
   - **输出写回**：计算完成，得到的分割结果（一个概率图）被写回系统内存。
4. **后处理与合成**：相机App拿到NPU生成的分割掩膜，再调用CPU/GPU的图形处理能力，根据这个掩膜对原始图像进行背景模糊（虚化）合成。最终，一张背景虚化的人像照片呈现在你的屏幕上。

**核心要点**：

- **NPU是协处理器**：它不负责整体逻辑（那是CPU的事），只负责其中最“重”的、模式固定的张量计算部分。
- **“翻译官”是关键**：驱动程序和编译器负责将通用的AI模型“翻译”成NPU能理解的专属指令，并管理其内存和任务队列。这个“翻译”和优化水平，直接决定了NPU的性能发挥。