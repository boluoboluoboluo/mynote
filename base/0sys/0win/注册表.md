

### **一、注册表的核心结构**

注册表的逻辑结构很像 **“资源管理器”中的文件和文件夹**，但它有自己的专用术语。

| 资源管理器 (比喻) | 注册表 (实际)       | 说明                 |
| :---------------- | :------------------ | :------------------- |
| **驱动器** (如C:) | **根键 / 配置单元** | 最顶层的分支。       |
| **文件夹**        | **项**              | 可以包含子项和值。   |
| **子文件夹**      | **子项**            | 项下的项。           |
| **文件**          | **值项**            | 实际存储数据的地方。 |
| **文件名**        | **值名称**          | 值项的名称。         |
| **文件内容**      | **值数据**          | 配置信息的具体数值。 |

**重要提示**：在注册表编辑器中，看起来像“文件夹”的图标就是 **“项”**，右侧窗格显示的是该“项”下的 **“值”**。

### **二、 五大根键详解**

打开注册表编辑器 (`regedit.exe`)，你会看到五个主要的根键，每个都有特定用途：

1. **`HKEY_CLASSES_ROOT` (缩写：`HKCR`)**
   - **功能**：**文件关联** 和 **COM对象注册**。
   - **内容**：存储文件扩展名（如 `.txt`）与打开程序的关联（如 记事本），以及OLE、ActiveX等对象的类信息。
   - **来源**：本质上是 `HKEY_LOCAL_MACHINE\SOFTWARE\Classes` 和 `HKEY_CURRENT_USER\SOFTWARE\Classes` 的合并视图（用户设置优先）。
2. **`HKEY_CURRENT_USER` (缩写：`HKCU`)**
   - **功能**：**当前登录用户的个人配置**。
   - **内容**：包括用户的桌面主题、文件夹设置、控制面板选项、网络驱动器映射、个人软件设置等。每个用户都有自己的 `HKCU`。
   - **来源**：对应 `HKEY_USERS\<当前用户的SID>`。
3. **`HKEY_LOCAL_MACHINE` (缩写：`HKLM`)**
   - **功能**：**本地计算机的全局硬件和软件配置**。
   - **内容**：这是最庞大、最重要的根键之一。包含所有用户的共享设置，如安装的硬件、驱动程序、启动项、系统服务、安全策略、已安装的软件（全局部分）等。
   - **重要子项**：
     - `SOFTWARE`：已安装程序的全局设置。
     - `SYSTEM`：系统启动、设备驱动、服务的核心配置。
     - `HARDWARE`：硬件设备和资源信息（动态生成）。
4. **`HKEY_USERS` (缩写：`HKU`)**
   - **功能**：**所有加载到系统中的用户配置文件**。
   - **内容**：包含 `.DEFAULT`（默认用户配置，用于新用户和登录屏幕）以及已加载的用户配置（以用户的安全标识符 `SID` 命名）。`HKCU` 就是其中一个用户的快捷方式。
5. **`HKEY_CURRENT_CONFIG` (缩写：`HKCC`)**
   - **功能**：**当前硬件配置文件的设置**。
   - **内容**：主要是即插即用设备和显示设置的当前配置。
   - **来源**：本质上是 `HKLM\SYSTEM\CurrentControlSet\Hardware Profiles\Current` 的快捷方式。

------

### **四、 注册表的数据类型**

值项可以存储不同类型的数据，常见的有：

- **`REG_SZ`**：固定长度的字符串。最常用，用于存储文本、路径等（如 `"C:\Program Files"`）。
- **`REG_EXPAND_SZ`**：可扩展的字符串。包含环境变量（如 `%USERPROFILE%\Desktop`），系统在使用时会自动扩展。
- **`REG_DWORD`**：32位双字值。用于布尔值（0/1）或小数字（如 `0x00000001`）。
- **`REG_QWORD`**：64位四字值。用于64位整数。
- **`REG_BINARY`**：二进制数据。以十六进制存储原始数据，常用于硬件组件信息。
- **`REG_MULTI_SZ`**：多字符串值。一个包含多个字符串的数组，用 `NULL` 分隔（如 网络适配器IP地址列表）。
- **`REG_LINK`**：符号链接。指向另一个注册表项的指针，用户通常看不到。

### **五、 物理文件存储**

注册表数据实际存储在硬盘上的几个文件中，称为 **“配置单元文件”**：

- `C:\Windows\System32\config\`：存储 `HKLM` 下的 `SAM`、`SECURITY`、`SOFTWARE`、`SYSTEM` 等。
- `C:\Users\<用户名>\NTUSER.DAT`：存储每个用户的 `HKCU` 配置。
- `C:\Users\Default\NTUSER.DAT`：存储默认用户配置。

这些文件在系统运行时被锁定，无法直接访问。在恢复模式下可以挂载和修改。