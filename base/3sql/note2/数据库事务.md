### **原子性的实现机制**

#### 1. **Undo Log（回滚日志）**

- **作用**：记录事务修改前的数据旧值，用于回滚未提交的事务。
- **流程**：
  1. 事务修改数据前，将原始数据写入 Undo Log。
  2. 若事务回滚，根据 Undo Log 逆向执行，恢复数据。
  3. 事务提交后，Undo Log 可以被清理（或延迟清理以支持多版本并发控制，如 MVCC）。

#### 2. **Redo Log（重做日志）**

- **作用**：记录事务修改后的数据新值，用于崩溃后恢复已提交的事务。
- **流程**：
  1. 事务修改数据时，将新值写入 Redo Log。
  2. 事务提交时，Redo Log 必须刷盘（通过 `fsync` 确保持久化）。
  3. 数据库崩溃后，通过 Redo Log 重新执行已提交但未落盘的操作。

### **原子性示例**

假设事务 `T1` 执行转账操作：

1. `UPDATE Account SET balance = balance - 100 WHERE id = A;`
2. `UPDATE Account SET balance = balance + 100 WHERE id = B;`

**原子性保障流程**：

- 若第二步失败，通过 Undo Log 将账户 A 的余额恢复。
- 若提交前崩溃，恢复时事务未提交，自动回滚。
- 若提交后崩溃，通过 Redo Log 确保修改落盘。